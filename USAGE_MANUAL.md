# 商业WAF产品使用手册

## 1. 产品介绍

本商业WAF（Web Application Firewall）产品是一款功能强大的Web应用防护系统，提供全面的安全防护功能，包括：

- **域名管理**：支持多域名配置和管理
- **租户管理**：实现多租户隔离和资源分配
- **证书管理**：支持SSL/TLS证书的上传和管理
- **防护策略**：可配置的安全防护规则和策略
- **实时监控**：系统状态和防护效果的实时监控
- **API接口**：完整的RESTful API接口，支持自动化集成

## 2. 快速开始

### 2.1 系统要求

- Go 1.16或更高版本
- Windows/Linux/macOS操作系统

### 2.2 安装和启动

1. **安装Go环境**（如果尚未安装）
   - 访问 [Go官网](https://golang.org/) 下载并安装适合您系统的Go版本
   - 验证安装：`go version`

2. **构建WAF服务器**
   ```bash
   cd h:/waf
   go build ./cmd/waf-server
   ```

3. **启动WAF服务器**
   ```bash
   go run cmd/waf-server/main.go
   ```

4. **验证服务启动**
   - 服务器默认监听8080端口
   - 管理控制台：http://localhost:8080/console
   - API接口：http://localhost:8080/api

## 3. 管理控制台使用

### 3.1 访问控制台

打开浏览器，访问：http://localhost:8080/console

### 3.2 系统信息查看

在控制台首页，您可以查看系统版本和详细信息：

- 系统版本显示在页面顶部
- 系统详细配置以JSON格式展示在系统信息区域

### 3.3 域名管理

1. **查看域名列表**
   - 导航到域名管理页面
   - 查看所有已配置的域名

2. **添加新域名**
   - 点击"添加域名"按钮
   - 填写域名信息（域名、租户ID、源站信息等）
   - 点击"保存"完成添加

3. **编辑域名**
   - 在域名列表中，点击要编辑的域名
   - 修改相关信息
   - 点击"保存"完成编辑

4. **删除域名**
   - 在域名列表中，找到要删除的域名
   - 点击"删除"按钮
   - 确认删除操作

### 3.4 租户管理

1. **查看租户列表**
   - 导航到租户管理页面
   - 查看所有已创建的租户

2. **添加新租户**
   - 点击"添加租户"按钮
   - 填写租户信息（租户ID、名称、描述等）
   - 点击"保存"完成添加

3. **编辑租户**
   - 在租户列表中，点击要编辑的租户
   - 修改相关信息
   - 点击"保存"完成编辑

4. **删除租户**
   - 在租户列表中，找到要删除的租户
   - 点击"删除"按钮
   - 确认删除操作

### 3.5 证书管理

1. **查看证书列表**
   - 导航到证书管理页面
   - 查看所有已上传的证书

2. **上传新证书**
   - 点击"上传证书"按钮
   - 填写证书信息（证书名称、证书内容、私钥等）
   - 点击"保存"完成上传

3. **编辑证书**
   - 在证书列表中，点击要编辑的证书
   - 修改相关信息
   - 点击"保存"完成编辑

4. **删除证书**
   - 在证书列表中，找到要删除的证书
   - 点击"删除"按钮
   - 确认删除操作

### 3.6 防护策略管理

1. **查看防护策略列表**
   - 导航到防护策略页面
   - 查看所有已配置的防护策略

2. **添加新防护策略**
   - 点击"添加策略"按钮
   - 填写策略信息（策略名称、规则、优先级等）
   - 点击"保存"完成添加

3. **编辑防护策略**
   - 在策略列表中，点击要编辑的策略
   - 修改相关信息
   - 点击"保存"完成编辑

4. **删除防护策略**
   - 在策略列表中，找到要删除的策略
   - 点击"删除"按钮
   - 确认删除操作

## 4. API接口文档

### 4.1 配置管理API

#### 获取所有配置
- **URL**：`/api/configs`
- **方法**：`GET`
- **响应**：所有配置项的JSON数组

#### 获取单个配置
- **URL**：`/api/configs/{id}`
- **方法**：`GET`
- **响应**：单个配置项的JSON对象

#### 创建配置
- **URL**：`/api/configs`
- **方法**：`POST`
- **请求体**：配置项的JSON对象
- **响应**：创建的配置项

#### 更新配置
- **URL**：`/api/configs/{id}`
- **方法**：`PUT`
- **请求体**：更新后的配置项JSON对象
- **响应**：更新后的配置项

#### 删除配置
- **URL**：`/api/configs/{id}`
- **方法**：`DELETE`
- **响应**：删除成功的消息

#### 按类型获取配置
- **URL**：`/api/configs/type/{type}`
- **方法**：`GET`
- **响应**：指定类型的配置项数组

### 4.2 规则管理API

#### 获取所有规则
- **URL**：`/api/rules`
- **方法**：`GET`
- **响应**：所有规则的JSON数组

#### 获取单个规则
- **URL**：`/api/rules/{id}`
- **方法**：`GET`
- **响应**：单个规则的JSON对象

#### 创建规则
- **URL**：`/api/rules`
- **方法**：`POST`
- **请求体**：规则的JSON对象
- **响应**：创建的规则

#### 更新规则
- **URL**：`/api/rules/{id}`
- **方法**：`PUT`
- **请求体**：更新后的规则JSON对象
- **响应**：更新后的规则

#### 删除规则
- **URL**：`/api/rules/{id}`
- **方法**：`DELETE`
- **响应**：删除成功的消息

### 4.3 域名管理API

#### 获取所有域名
- **URL**：`/api/domains`
- **方法**：`GET`
- **响应**：所有域名的JSON数组

#### 获取单个域名
- **URL**：`/api/domains/{id}`
- **方法**：`GET`
- **响应**：单个域名的JSON对象

#### 创建域名
- **URL**：`/api/domains`
- **方法**：`POST`
- **请求体**：域名的JSON对象
- **响应**：创建的域名

#### 更新域名
- **URL**：`/api/domains/{id}`
- **方法**：`PUT`
- **请求体**：更新后的域名JSON对象
- **响应**：更新后的域名

#### 删除域名
- **URL**：`/api/domains/{id}`
- **方法**：`DELETE`
- **响应**：删除成功的消息

### 4.4 租户管理API

#### 获取所有租户
- **URL**：`/api/tenants`
- **方法**：`GET`
- **响应**：所有租户的JSON数组

#### 获取单个租户
- **URL**：`/api/tenants/{id}`
- **方法**：`GET`
- **响应**：单个租户的JSON对象

#### 创建租户
- **URL**：`/api/tenants`
- **方法**：`POST`
- **请求体**：租户的JSON对象
- **响应**：创建的租户

#### 更新租户
- **URL**：`/api/tenants/{id}`
- **方法**：`PUT`
- **请求体**：更新后的租户JSON对象
- **响应**：更新后的租户

#### 删除租户
- **URL**：`/api/tenants/{id}`
- **方法**：`DELETE`
- **响应**：删除成功的消息

### 4.5 证书管理API

#### 获取所有证书
- **URL**：`/api/certificates`
- **方法**：`GET`
- **响应**：所有证书的JSON数组

#### 获取单个证书
- **URL**：`/api/certificates/{id}`
- **方法**：`GET`
- **响应**：单个证书的JSON对象

#### 创建证书
- **URL**：`/api/certificates`
- **方法**：`POST`
- **请求体**：证书的JSON对象
- **响应**：创建的证书

#### 更新证书
- **URL**：`/api/certificates/{id}`
- **方法**：`PUT`
- **请求体**：更新后的证书JSON对象
- **响应**：更新后的证书

#### 删除证书
- **URL**：`/api/certificates/{id}`
- **方法**：`DELETE`
- **响应**：删除成功的消息

### 4.6 防护策略API

#### 获取所有防护策略
- **URL**：`/api/protection_policies`
- **方法**：`GET`
- **响应**：所有防护策略的JSON数组

#### 获取单个防护策略
- **URL**：`/api/protection_policies/{id}`
- **方法**：`GET`
- **响应**：单个防护策略的JSON对象

#### 创建防护策略
- **URL**：`/api/protection_policies`
- **方法**：`POST`
- **请求体**：防护策略的JSON对象
- **响应**：创建的防护策略

#### 更新防护策略
- **URL**：`/api/protection_policies/{id}`
- **方法**：`PUT`
- **请求体**：更新后的防护策略JSON对象
- **响应**：更新后的防护策略

#### 删除防护策略
- **URL**：`/api/protection_policies/{id}`
- **方法**：`DELETE`
- **响应**：删除成功的消息

## 5. 常见问题与故障排除

### 5.1 服务器启动失败

**问题**：启动WAF服务器时出现端口占用错误
**解决方案**：
1. 检查8080端口是否被其他进程占用：`netstat -ano | findstr :8080`
2. 终止占用端口的进程：`taskkill /F /PID <进程ID>`
3. 重新启动WAF服务器

### 5.2 API请求返回404错误
**问题**：调用API接口时返回404 Not Found
**解决方案**：
1. 检查API路径是否正确
2. 确保请求方法（GET/POST/PUT/DELETE）正确
3. 检查服务器是否正常运行

### 5.3 证书上传失败
**问题**：上传证书时失败
**解决方案**：
1. 检查证书格式是否正确（PEM格式）
2. 确保证书内容和私钥完整
3. 检查文件大小是否超过限制

## 6. 系统维护

### 6.1 日志查看
WAF服务器日志输出到控制台，您可以通过以下方式查看：
- 实时查看：启动服务器时在控制台查看
- 配置日志文件：修改配置将日志输出到文件

### 6.2 性能监控
- 系统状态信息可通过管理控制台查看
- 监控指标API：`/api/metrics`（如果已实现）

### 6.3 更新系统
1. 获取最新代码
2. 重新构建：`go build ./cmd/waf-server`
3. 停止当前运行的服务器
4. 启动新构建的服务器

## 7. 联系支持

如果您在使用过程中遇到问题或有任何建议，欢迎联系我们的技术支持团队：

- 邮箱：support@yourcompany.com
- 电话：400-123-4567
- 文档：https://yourcompany.com/docs/waf

---

© 2025 Your Company. 保留所有权利。